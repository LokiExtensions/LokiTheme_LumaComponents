<?php
declare(strict_types=1);

/** @version 0.0.21 */

use Magento\Framework\View\Element\Template;

/** @var Template $block */
?>
<script>
    document.addEventListener('alpine:init', () => {
        const form = document.getElementById('product_addtocart_form');
        if (!form) {
            return;
        }

        const button = form.querySelector('button[type="submit"]');
        button.disabled = false;

        form.addEventListener('submit', (e) => {
            button.disabled = true;

            e.preventDefault();

            const data = new FormData();
            data.append('product', form.querySelector('input[name="product"]').value);
            data.append('item', form.querySelector('input[name="item"]').value);
            data.append('qty', form.querySelector('input[name="qty"]').value);
            data.append('related_product', form.querySelector('input[name="related_product"]').value);

            const optionElement = form.querySelector('input[name="selected_configurable_option"]');
            data.append('selected_configurable_option', optionElement.value);
            data.append('form_key', form.querySelector('input[name="form_key"]').value);

            fetch(form.action, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                },
                body: data
            }).finally(function () {
                Alpine.store('LocalStorage').refresh('cart,messages', true);
                button.disabled = false;
            });
        });
    });
</script>
